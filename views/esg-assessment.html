<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼æ¥­æ°¸çºŒç¶“æ¿Ÿæ´»å‹•è‡ªè©• - åœŸåœ°éŠ€è¡Œç¶ æ˜“é€š (Green 'E' Pass)</title>
    <link rel="icon" type="image/svg+xml" href="/images/plant-sprout-icon.svg">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/chat-assistant.css">
    <style>
        /* ESGè©•ä¼°å°ˆç”¨æ¨£å¼ */
        .esg-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .esg-header {
            background: linear-gradient(135deg, #006633 0%, #00b3b3 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .esg-header h1 {
            font-size: 2rem;
            margin: 0 0 0.5rem 0;
            font-weight: 700;
        }

        .esg-header p {
            margin: 0;
            opacity: 0.95;
            line-height: 1.6;
        }

        .esg-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .esg-tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            margin-bottom: -2px;
        }

        .esg-tab-btn:hover {
            color: #006633;
        }

        .esg-tab-btn.active {
            color: #006633;
            border-bottom-color: #006633;
        }

        .esg-tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .esg-tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .esg-section {
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(0, 102, 51, 0.03) 0%, rgba(0, 179, 179, 0.03) 100%);
            border-left: 4px solid #006633;
            border-radius: 8px;
        }

        .esg-section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #006633;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 0.75rem;
        }

        .esg-form-group {
            margin-bottom: 1.5rem;
        }

        .esg-form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .esg-form-group input,
        .esg-form-group select,
        .esg-form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .esg-form-group input:focus,
        .esg-form-group select:focus,
        .esg-form-group textarea:focus {
            outline: none;
            border-color: #006633;
            box-shadow: 0 0 0 3px rgba(0, 102, 51, 0.1);
        }

        .esg-form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .esg-form-group.checkbox-group {
            margin-bottom: 1.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }

        .checkbox-item:hover {
            background-color: rgba(0, 102, 51, 0.05);
        }

        .checkbox-item input[type="checkbox"],
        .checkbox-item input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin: 0;
            flex-shrink: 0;
            accent-color: #006633;
        }

        .checkbox-item label {
            margin: 0;
            font-weight: 400;
            cursor: pointer;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            line-height: 1.5;
        }

        /* æ”¹é€²radioå’Œcheckboxçµ„çš„ä½ˆå±€ */
        .radio-group,
        .checkbox-group-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .radio-item,
        .check-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .radio-item:hover,
        .check-item:hover {
            background: white;
            border-color: #006633;
            box-shadow: 0 2px 8px rgba(0, 102, 51, 0.1);
        }

        .radio-item input[type="radio"],
        .check-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin: 0;
            flex-shrink: 0;
            accent-color: #006633;
        }

        .radio-item label,
        .check-item label {
            margin: 0;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
            color: #333;
            font-size: 0.95rem;
        }

        .radio-item label:hover,
        .check-item label:hover {
            color: #006633;
        }

        .activity-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .activity-card:hover {
            border-color: #006633;
            box-shadow: 0 4px 12px rgba(0, 102, 51, 0.1);
        }

        .activity-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .activity-sequence {
            font-size: 1.2rem;
            font-weight: 700;
            color: #006633;
        }

        .activity-rating {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .rating-y {
            background: #d4edda;
            color: #155724;
        }

        .rating-t {
            background: #fff3cd;
            color: #856404;
        }

        .rating-n {
            background: #f8d7da;
            color: #721c24;
        }

        .rating-x {
            background: #d6d8db;
            color: #383d41;
        }

        .btn-add-activity {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #006633;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-add-activity:hover {
            background: #004d26;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 102, 51, 0.2);
        }

        .btn-remove-activity {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            background: #f8d7da;
            color: #721c24;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-remove-activity:hover {
            background: #f5c6cb;
        }

        .submit-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid #e0e0e0;
            text-align: center;
        }

        .btn-submit {
            padding: 1rem 3rem;
            background: linear-gradient(135deg, #006633 0%, #004d26 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 102, 51, 0.2);
        }

        .btn-submit:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0, 102, 51, 0.3);
        }

        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .form-hint {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .required {
            color: #dc3545;
            margin-left: 0.25rem;
        }

        @media (max-width: 768px) {
            .esg-container {
                padding: 1.5rem;
            }

            .esg-header {
                padding: 2rem 1.5rem;
            }

            .esg-header h1 {
                font-size: 1.5rem;
            }

            .esg-tabs {
                gap: 0.5rem;
            }

            .esg-tab-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }

            .esg-form-row {
                grid-template-columns: 1fr;
            }

            .btn-submit {
                width: 100%;
            }
        }

        .checkbox-group-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .check-item {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            background: white;
            border: 1.5px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .check-item:hover {
            background: #f5faf8;
            border-color: #006633;
        }

        .check-item input[type="checkbox"] {
            margin-right: 0.75rem;
            margin-top: 0.25rem;
            cursor: pointer;
            width: 20px;
            height: 20px;
            accent-color: #006633;
            flex-shrink: 0;
        }

        .check-item label {
            cursor: pointer;
            flex: 1;
            font-size: 0.95rem;
            line-height: 1.5;
            margin: 0;
            word-break: break-word;
        }

        /* é€²åº¦æ¢å®¹å™¨ */
        .esg-progress-container {
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .esg-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #333;
        }

        .esg-progress-percentage {
            font-size: 1.5rem;
            color: #006633;
            font-weight: 700;
        }

        .progress-bar-wrapper {
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #006633 0%, #00b3b3 100%);
            transition: width 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 102, 51, 0.3);
        }

        /* è©•ä¼°ç‹€æ…‹æç¤º */
        .esg-status-indicator {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, rgba(0, 102, 51, 0.05), rgba(0, 179, 179, 0.05));
            border-left: 4px solid #006633;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            color: #333;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #006633;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <img src="/images/land-bank-logo.jpg" alt="åœŸåœ°éŠ€è¡Œ" class="logo-icon">
                <span>åœŸåœ°éŠ€è¡Œç¶ æ˜“é€š <span style="font-size: 0.85em; font-weight: 400;">(Green 'E' Pass)</span></span>
            </div>
            <ul class="nav-links">
                <li><a href="/">é¦–é </a></li>
                <li><a href="/assessment">ESGè©•ä¼°</a></li>
                <li><a href="/esg-tracker">æ”¹å–„è¿½è¹¤</a></li>
                <li><a href="/sustainability">æ°¸çºŒå¹³å°</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <section class="esg-header">
            <h1>ğŸ“‹ ä¼æ¥­æ°¸çºŒç¶“æ¿Ÿæ´»å‹•è‡ªè©•å•å·</h1>
            <p>ä¾æ“šã€Œæ°¸çºŒç¶“æ¿Ÿæ´»å‹•èªå®šåƒè€ƒæŒ‡å¼•(ç¬¬äºŒç‰ˆ)ã€ï¼Œå”åŠ©ä¼æ¥­è©•ä¼°ç¶“æ¿Ÿæ´»å‹•æ˜¯å¦ç¬¦åˆæ°¸çºŒç™¼å±•æ¨™æº–ã€‚</p>
        </section>

        <section class="esg-container">
            <!-- åˆ†é æ¨™ç±¤ -->
            <div class="esg-tabs">
                <button class="esg-tab-btn active" onclick="switchTab(event, 'table1')">
                    ğŸ“Š è¡¨æ ¼ä¸€ï¼šä¼æ¥­ESGè³‡è¨Š
                </button>
                <button class="esg-tab-btn" onclick="switchTab(event, 'table2')">
                    âœ“ è¡¨æ ¼äºŒï¼šç¶“æ¿Ÿæ´»å‹•è©•ä¼°
                </button>
            </div>

            <!-- ========== è¡¨æ ¼ä¸€ï¼šä¼æ¥­ESGè³‡è¨Š ========== -->
            <div id="table1" class="esg-tab-content active">
                <!-- é€²åº¦æ¢ -->
                <div class="esg-progress-container">
                    <div class="esg-progress-header">
                        <span>ğŸ“‹ è©•ä¼°é€²åº¦</span>
                        <span class="esg-progress-percentage"><span id="progress-percentage">0</span>%</span>
                    </div>
                    <div class="progress-bar-wrapper">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <div style="margin-top: 0.75rem; font-size: 0.9rem; color: #666;">
                        å·²å¡«å¯«: <span id="completed-fields">0</span> / <span id="total-fields">0</span> æ¬„ä½
                    </div>
                </div>

                <!-- è©•ä¼°ç‹€æ…‹æç¤º -->
                <div class="esg-status-indicator">
                    <span class="status-dot"></span>
                    <span>ğŸ”„ ç³»çµ±æ­£åœ¨è©•ä¼°æ‚¨çš„å›ç­”ï¼Œè«‹å®Œæ•´å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼ˆæ¨™è¨˜ <span class="required" style="color: #dc3545;">*</span>ï¼‰</span>
                </div>

                <!-- ä¸€ã€åŸºæœ¬è³‡æ–™ -->
                <div class="esg-section">
                    <div class="esg-section-title">ä¸€ã€åŸºæœ¬è³‡æ–™</div>

                    <div class="esg-form-row">
                        <div class="esg-form-group">
                            <label>ä¼æ¥­åç¨± <span class="required">*</span></label>
                            <input type="text" id="company-name" placeholder="è«‹è¼¸å…¥ä¼æ¥­åç¨±" required>
                        </div>
                        <div class="esg-form-group">
                            <label>ä¼æ¥­çµ±ç·¨ <span class="required">*</span></label>
                            <input type="text" id="company-tax-id" placeholder="è«‹è¼¸å…¥çµ±ä¸€ç·¨è™Ÿ" required>
                        </div>
                    </div>

                    <div class="esg-form-row">
                        <div class="esg-form-group">
                            <label>éå»ä¸€å¹´å¹´åº¦ <span class="required">*</span></label>
                            <input type="number" id="past-year" placeholder="ä¾‹ï¼š113" required>
                        </div>
                        <div class="esg-form-group">
                            <label>å¡«å¯«æ—¥æœŸ <span class="required">*</span></label>
                            <input type="date" id="assessment-date" required>
                        </div>
                    </div>

                    <div class="esg-form-row">
                        <div class="esg-form-group">
                            <label>éå»ä¸€å¹´ç‡Ÿæ¥­æ”¶å…¥ (åƒå…ƒ) <span class="required">*</span></label>
                            <input type="number" id="revenue" placeholder="è«‹è¼¸å…¥ç‡Ÿæ¥­æ”¶å…¥" required>
                        </div>
                        <div class="esg-form-group">
                            <label>éå»ä¸€å¹´è³‡ç”¢ç¸½é¡ (åƒå…ƒ) <span class="required">*</span></label>
                            <input type="number" id="total-assets" placeholder="è«‹è¼¸å…¥è³‡ç”¢ç¸½é¡" required>
                        </div>
                    </div>

                    <div class="esg-form-group">
                        <label>ç‡Ÿæ¥­æ”¶å…¥/è³‡ç”¢è³‡æ–™å±¬æ€§ <span class="required">*</span></label>
                        <select id="data-attribute" required>
                            <option value="">-- è«‹é¸æ“‡ --</option>
                            <option value="financial-audit">è²¡å‹™ç°½è­‰</option>
                            <option value="tax-audit">ç¨…å‹™ç°½è­‰</option>
                            <option value="self-report">è‡ªçµå ±å‘Š</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                </div>

                <!-- äºŒã€æº«å®¤æ°£é«”æ’æ”¾ -->
                <div class="esg-section">
                    <div class="esg-section-title">äºŒã€éå»ä¸€å¹´æº«å®¤æ°£é«”æ’æ”¾</div>
                    <p class="form-hint">ç›¤æŸ¥é‚Šç•Œä¿‚ä»¥å…¨å…¬å¸ç‚ºä¸»ï¼Œå¦‚åƒ…éƒ¨åˆ†ç›¤æŸ¥ï¼Œè«‹æ–¼ä¸‹æ–¹èªªæ˜</p>
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background-color: #f0f7f3; border-left: 4px solid #00b3b3; border-radius: 6px;">
                        <p style="margin: 0; font-size: 0.95rem; color: #333;">
                            ğŸ’¡ <strong>æº«å®¤æ°£é«”æ’æ”¾é‡ä¼°ç®—å·¥å…·ï¼š</strong> 
                            å¦‚éœ€å”åŠ©ä¼°ç®—æº«å®¤æ°£é«”æ’æ”¾é‡ï¼Œå¯ä½¿ç”¨
                            <a href="https://ghgregistry.moenv.gov.tw/epa_ghg/calcaulate/03_2_info_edit.aspx" target="_blank" style="color: #006633; text-decoration: underline; font-weight: 600;">
                              ç’°å¢ƒéƒ¨æ°£å€™è®Šé·ç½²ã€Œäº‹æ¥­æº«å®¤æ°£é«”æ’æ”¾é‡è³‡è¨Šå¹³å°ã€è©¦ç®—å·¥å…·
                            </a>
                            é€²è¡Œè¨ˆç®—ã€‚
                        </p>
                    </div>

                    <div class="esg-form-group">
                        <label>ç›´æ¥æ’æ”¾ (ç¯„ç–‡ä¸€) - å…¬å™¸COâ‚‚ç•¶é‡</label>
                        <input type="number" id="scope1-emissions" placeholder="0" min="0" step="0.01">
                    </div>

                    <div class="esg-form-group checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="scope1-verification">
                            <label for="scope1-verification">ç¶“ç¬¬ä¸‰æ–¹æ©Ÿæ§‹é©—è­‰</label>
                        </div>
                    </div>

                    <div class="esg-form-group">
                        <label>èƒ½æºé–“æ¥æ’æ”¾ (ç¯„ç–‡äºŒ) - å…¬å™¸COâ‚‚ç•¶é‡</label>
                        <input type="number" id="scope2-emissions" placeholder="0" min="0" step="0.01">
                    </div>

                    <div class="esg-form-group checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="scope2-verification">
                            <label for="scope2-verification">ç¶“ç¬¬ä¸‰æ–¹æ©Ÿæ§‹é©—è­‰</label>
                        </div>
                    </div>

                    <div class="esg-form-group">
                        <label>å…¶ä»–é–“æ¥æ’æ”¾ (ç¯„ç–‡ä¸‰) - å…¬å™¸COâ‚‚ç•¶é‡</label>
                        <input type="number" id="scope3-emissions" placeholder="0" min="0" step="0.01">
                    </div>

                    <div class="esg-form-group checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="scope3-verification">
                            <label for="scope3-verification">ç¶“ç¬¬ä¸‰æ–¹æ©Ÿæ§‹é©—è­‰</label>
                        </div>
                    </div>

                    <div class="esg-form-group">
                        <label>éƒ¨åˆ†ç›¤æŸ¥é‚Šç•Œèªªæ˜ (50å­—å…§)</label>
                        <textarea id="boundary-description" rows="3" placeholder="è‹¥ç‚ºå…¨å…¬å¸ç›¤æŸ¥å¯ç•™ç©º"></textarea>
                    </div>
                </div>

                <!-- ä¸‰ã€èƒ½æºç®¡ç† -->
                <div class="esg-section">
                    <div class="esg-section-title">ä¸‰ã€èƒ½æºç®¡ç†</div>

                    <div style="margin-bottom: 1.5rem; padding: 1rem; background-color: #f0f7f3; border-left: 4px solid #00b3b3; border-radius: 6px;">
                        <p style="margin: 0; font-size: 0.95rem; color: #333; line-height: 1.6;">
                            ğŸ’¡ <strong>ç”¨é›»/ç”¨æ°´æŸ¥è©¢èªªæ˜ï¼š</strong> 
                            ç”¨é›»åŠç”¨æ°´åº¦æ•¸å¯ä¸‹è¼‰ã€Šå°ç£é›»åŠ›APPã€‹ã€ã€Šå°ç£è‡ªä¾†æ°´APPã€‹ï¼Œæˆ–Mydataç¶²ç«™(ç¶²å€ï¼šmydata.nat.gov.tw)é€²è¡ŒæŸ¥è©¢ã€‚
                        </p>
                    </div>

                    <div class="esg-form-row">
                        <div class="esg-form-group">
                            <label>å…¨å…¬å¸ç”¨é›»ç¸½åº¦æ•¸ (åº¦)</label>
                            <input type="number" id="electricity-usage" placeholder="0" min="0">
                        </div>
                        <div class="esg-form-group">
                            <label>å…¨å…¬å¸ç”¨æ°´åº¦æ•¸ (åº¦)</label>
                            <input type="number" id="water-usage" placeholder="0" min="0">
                        </div>
                    </div>

                    <div class="esg-form-group">
                        <label>ä½¿ç”¨å†ç”Ÿèƒ½æº</label>
                        <select id="renewable-energy" onchange="toggleRenewableFields()">
                            <option value="">-- è«‹é¸æ“‡ --</option>
                            <option value="no">å¦</option>
                            <option value="yes">æ˜¯</option>
                        </select>
                    </div>

                    <div id="renewable-fields" style="display:none;">
                        <div class="esg-form-row">
                            <div class="esg-form-group">
                                <label>å¤–è³¼å†ç”Ÿèƒ½æºåº¦æ•¸</label>
                                <input type="number" id="renewable-purchased" placeholder="0" min="0">
                            </div>
                            <div class="esg-form-group">
                                <label>è‡ªç”¢å†ç”Ÿèƒ½æºåº¦æ•¸</label>
                                <input type="number" id="renewable-produced" placeholder="0" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="esg-form-group checkbox-group">
                        <label>èƒ½æºç®¡ç†ç³»çµ±é©—è­‰ (å¦‚ISO 50001)</label>
                        <div class="checkbox-item">
                            <input type="checkbox" id="energy-management-system">
                            <label for="energy-management-system">å·²å–å¾—é©—è­‰</label>
                        </div>
                    </div>

                    <div class="esg-form-group">
                        <label>å†ç”Ÿèƒ½æºæ†‘è­‰ (RECs) ç´¯ç©è³¼è²·é‡ (å¼µ)</label>
                        <input type="number" id="rec-certificates" placeholder="0" min="0">
                    </div>
                </div>

                <!-- å››ã€ESGè©•ä¼° -->
                <div class="esg-section">
                    <div class="esg-section-title">å››ã€ç’°å¢ƒä¿è­·ã€ç¤¾æœƒè²¬ä»»èˆ‡å…¬å¸æ²»ç†</div>

                    <!-- ç’°ä¿é …ç›® -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: #006633; margin-bottom: 1rem;">ğŸŒ ç’°å¢ƒä¿è­· (E)</h3>
                        <div class="esg-form-group checkbox-group">
                            <label>E1: å…¬å¸è¿‘ä¸‰å¹´å…§é€²è¡Œç¯€èƒ½æ¡è³¼ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="e1" value="yes" id="e1-yes">
                                <label for="e1-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="e1" value="no" id="e1-no">
                                <label for="e1-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>E2: å…¬å¸é‡å°ç¯€èƒ½æœ‰é€²è¡Œæ§ç®¡ä¸¦è¨‚å®šé‡åŒ–æŒ‡æ¨™ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="e2" value="yes" id="e2-yes">
                                <label for="e2-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="e2" value="no" id="e2-no">
                                <label for="e2-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>E3: å…¬å¸å°æ–¼ç¢³æ’æ¸›é‡æœ‰é€²è¡Œæ¡è³¼æˆ–è½‰å‹è¨ˆç•«ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="e3" value="yes" id="e3-yes">
                                <label for="e3-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="e3" value="no" id="e3-no">
                                <label for="e3-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>E4: å…¬å¸è¿‘ä¸‰å¹´ç„¡ç’°å¢ƒæ±¡æŸ“ç­‰è£ç½°äº‹é …ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="e4" value="yes" id="e4-yes">
                                <label for="e4-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="e4" value="no" id="e4-no">
                                <label for="e4-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>E5: å…¬å¸é‡å°ç¶ èƒ½å»ºç½®æœ‰é€²è¡ŒæŠ•è³‡æˆ–æ˜ç¢ºè¨ˆç•«ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="e5" value="yes" id="e5-yes">
                                <label for="e5-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="e5" value="no" id="e5-no">
                                <label for="e5-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>E6: å…¬å¸é‡å°å»¢æ£„ç‰©è³‡æºå¾ªç’°åˆ©ç”¨æˆ–ä¿ƒé€²åŸç‰©æ–™æ°¸çºŒä½¿ç”¨ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="e6" value="yes" id="e6-yes">
                                <label for="e6-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="e6" value="no" id="e6-no">
                                <label for="e6-no">å¦</label>
                            </div>
                        </div>
                    </div>

                    <!-- ç¤¾æœƒé …ç›® -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: #006633; margin-bottom: 1rem;">ğŸ‘¥ ç¤¾æœƒè²¬ä»» (S)</h3>
                        <div class="esg-form-group checkbox-group">
                            <label>S1: å…¬å¸è¿‘ä¸‰å¹´ç„¡é„°å±…æª¢èˆ‰äº‹ä»¶ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="s1" value="yes" id="s1-yes">
                                <label for="s1-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="s1" value="no" id="s1-no">
                                <label for="s1-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>S2: å…¬å¸è¿‘ä¸‰å¹´ç„¡å‹å·¥è£ç½°äº‹é …ç™¼ç”Ÿï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="s2" value="yes" id="s2-yes">
                                <label for="s2-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="s2" value="no" id="s2-no">
                                <label for="s2-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>S3: å…¬å¸è¿‘ä¸‰å¹´æ›¾æœ‰å…¬ç›Šæˆ–ç›¸é—œæ¡è³¼ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="s3" value="yes" id="s3-yes">
                                <label for="s3-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="s3" value="no" id="s3-no">
                                <label for="s3-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>S4: å…¬å¸è˜ç”¨å¼±å‹¢æ—ç¾¤æˆ–æä¾›å­¸ç”Ÿå¯¦ç¿’è¨ˆç•«ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="s4" value="yes" id="s4-yes">
                                <label for="s4-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="s4" value="no" id="s4-no">
                                <label for="s4-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>S5: å…¬å¸æŠ•è³‡ESGç›¸é—œç¶ è‰²é‡‘èå•†å“ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="s5" value="yes" id="s5-yes">
                                <label for="s5-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="s5" value="no" id="s5-no">
                                <label for="s5-no">å¦</label>
                            </div>
                        </div>
                    </div>

                    <!-- æ²»ç†é …ç›® -->
                    <div>
                        <h3 style="color: #006633; margin-bottom: 1rem;">âš–ï¸ å…¬å¸æ²»ç† (G)</h3>
                        <div class="esg-form-group checkbox-group">
                            <label>G1: å…¬å¸æœ‰ä¾ç…§è¦å®šç¹³ç¨…ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="g1" value="yes" id="g1-yes">
                                <label for="g1-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="g1" value="no" id="g1-no">
                                <label for="g1-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>G2: å…¬å¸ç„¡æ¼é–‹ç™¼ç¥¨ç­‰æ•…æ„äº‹é …ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="g2" value="yes" id="g2-yes">
                                <label for="g2-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="g2" value="no" id="g2-no">
                                <label for="g2-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>G3: å…¬å¸è¿‘ä¸‰å¹´ç„¡é€ƒæ¼è£ç½°äº‹é …ç™¼ç”Ÿï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="g3" value="yes" id="g3-yes">
                                <label for="g3-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="g3" value="no" id="g3-no">
                                <label for="g3-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>G4: å…¬å¸è¿‘ä¸‰å¹´çš†æœ‰ç›ˆé¤˜ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="g4" value="yes" id="g4-yes">
                                <label for="g4-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="g4" value="no" id="g4-no">
                                <label for="g4-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>G5: å…¬å¸æœ‰å®šæœŸå¬é–‹è‘£äº‹æœƒä¸¦èªªæ˜è²¡å‹™ç‹€æ³ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="g5" value="yes" id="g5-yes">
                                <label for="g5-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="g5" value="no" id="g5-no">
                                <label for="g5-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>G6: å…¬å¸æœ‰å®šæœŸèˆ‡è‚¡æ±æˆ–é—œä¿‚äººèªªæ˜ç‡Ÿé‹ç‹€æ³ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="g6" value="yes" id="g6-yes">
                                <label for="g6-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="g6" value="no" id="g6-no">
                                <label for="g6-no">å¦</label>
                            </div>
                        </div>

                        <div class="esg-form-group checkbox-group">
                            <label>G7: å…¬å¸æœ‰ç·¨è£½æ°¸çºŒå ±å‘Šæ›¸ï¼Ÿ</label>
                            <div class="checkbox-item">
                                <input type="radio" name="g7" value="yes" id="g7-yes">
                                <label for="g7-yes">æ˜¯</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" name="g7" value="no" id="g7-no">
                                <label for="g7-no">å¦</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è¡¨æ ¼ä¸€çš„ä¸‹ä¸€æ­¥æŒ‰éˆ• -->
                <div class="submit-section" style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                    <button type="button" class="btn-next" onclick="goToTable2()" style="background-color: #006633; color: white; padding: 0.75rem 2rem; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease;">
                        âœ ä¸‹ä¸€æ­¥ï¼šé€²å…¥è¡¨æ ¼äºŒ
                    </button>
                </div>
            </div>

            <!-- ========== è¡¨æ ¼äºŒï¼šç¶“æ¿Ÿæ´»å‹•è©•ä¼° ========== -->
            <div id="table2" class="esg-tab-content">
                <div class="esg-section">
                    <div class="esg-section-title">äºŒã€è‡ªè©•ç¶“æ¿Ÿæ´»å‹•é©ç”¨/ç¬¦åˆæ°¸çºŒç¶“æ¿Ÿæ´»å‹•èªå®šåƒè€ƒæŒ‡å¼•(ç¬¬äºŒç‰ˆ)ä¹‹æƒ…å½¢</div>

                    <div class="esg-form-group">
                        <label>ä¼æ¥­åœ¨è¡¡é‡æœŸé–“æ˜¯å¦æœ‰ä»»ä¸€ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•æˆ–å€‹åˆ¥å°ˆæ¡ˆé …ç›®é©ç”¨æœ¬æŒ‡å¼•ï¼Ÿ <span class="required">*</span></label>
                        <select id="has-applicable-activities" onchange="toggleActivitiesTable()" required>
                            <option value="">-- è«‹é¸æ“‡ --</option>
                            <option value="no">å¦ (æ¯‹éœ€å¡«å¯«è¡¨æ ¼äºŒ)</option>
                            <option value="yes">æ˜¯ (è«‹çºŒç­”ä¸‹ä¸€é¡Œ)</option>
                        </select>
                    </div>

                    <div id="activities-selection" style="display: none;">
                        <div class="esg-form-group checkbox-group">
                            <label>è«‹å•æ‚¨è¦è‡ªè©•çš„é …ç›®åŒ…å«å“ªäº›ï¼Ÿ (å¯è¤‡é¸)</label>
                            <div class="checkbox-item">
                                <input type="checkbox" id="include-operating" onchange="updateActivityTables()">
                                <label for="include-operating">ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="include-projects" onchange="updateActivityTables()">
                                <label for="include-projects">å€‹åˆ¥å°ˆæ¡ˆé …ç›®</label>
                            </div>
                        </div>
                    </div>

                    <!-- ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•éƒ¨åˆ† -->
                    <div id="operating-activities-section" style="display: none; margin-top: 2rem;">
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #006633; margin-bottom: 1rem;">ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•</h3>
                            <div id="operating-activities-container"></div>
                            <button type="button" class="btn-add-activity" onclick="addOperatingActivity()">
                                + æ–°å¢ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•
                            </button>
                        </div>
                    </div>

                    <!-- å€‹åˆ¥å°ˆæ¡ˆé …ç›®éƒ¨åˆ† -->
                    <div id="project-activities-section" style="display: none; margin-top: 2rem;">
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #006633; margin-bottom: 1rem;">å€‹åˆ¥å°ˆæ¡ˆé …ç›®</h3>
                            <div id="project-activities-container"></div>
                            <button type="button" class="btn-add-activity" onclick="addProjectActivity()">
                                + æ–°å¢å€‹åˆ¥å°ˆæ¡ˆé …ç›®
                            </button>
                        </div>
                    </div>
                </div>

                <!-- è¡¨æ ¼äºŒçš„æ“ä½œæŒ‰éˆ• -->
                <div class="submit-section" style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                    <button type="button" class="btn-back" onclick="goToTable1()" style="background-color: #999; color: white; padding: 0.75rem 2rem; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease;">
                        â¬… è¿”å›è¡¨æ ¼ä¸€
                    </button>
                    <button class="btn-submit" onclick="submitAssessment()">
                        ğŸ“Š æäº¤è©•ä¼°ä¸¦æŸ¥çœ‹çµæœ
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- ESGè©•ä¼°è¼‰å…¥ä»‹é¢ -->
    <div id="assessment-loading" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 1000;">
        <div style="background: white; padding: 2.5rem; border-radius: 12px; text-align: center; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);">
            <div style="font-size: 3.5rem; margin-bottom: 1rem; animation: bounce 1s infinite;">â³</div>
            <p style="font-size: 1.2rem; font-weight: 700; color: #006633; margin: 0 0 0.75rem 0;">æ­£åœ¨è©•ä¼°æ‚¨çš„å›ç­”...</p>
            <p style="color: #666; margin: 0; font-size: 0.95rem;">ç³»çµ±æ­£åœ¨åˆ†ææ°¸çºŒç¶“æ¿Ÿæ´»å‹•ç¬¦åˆåº¦ï¼Œè«‹ç¨å€™...</p>
            <p style="color: #999; margin-top: 1rem; font-size: 0.85rem;">â±ï¸ é€šå¸¸éœ€è¦ 5-15 ç§’é˜ï¼ˆå–æ±ºæ–¼ AI åˆ†æé€Ÿåº¦ï¼‰</p>
        </div>
    </div>

    <style>
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>

    <footer>
        <p>&copy; 2025 åœŸåœ°éŠ€è¡Œ | ç¶ æ˜“é€š (Green 'E' Pass)</p>
    </footer>

    <script src="/js/esg-data.js"></script>
    <script>
        // å…¨å±€è®Šæ•¸
        let operatingActivityCount = 0;
        let projectActivityCount = 0;

        // ç”Ÿæˆç¶“æ¿Ÿæ´»å‹•ä»£è™Ÿé¸é …
        function getActivityCodeOptions() {
            return Object.entries(ESG_ACTIVITIES)
                .map(([code, activity]) => `<option value="${code}">${code} - ${activity.name}</option>`)
                .join('');
        }

        // Tab åˆ‡æ›å‡½æ•¸
        function switchTab(event, tabName) {
            event.preventDefault();
            
            // éš±è—æ‰€æœ‰ tab
            document.querySelectorAll('.esg-tab-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.esg-tab-btn').forEach(el => {
                el.classList.remove('active');
            });

            // é¡¯ç¤ºé¸å®šçš„ tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // åˆ‡æ›å†ç”Ÿèƒ½æºæ¬„ä½
        function toggleRenewableFields() {
            const renewableValue = document.getElementById('renewable-energy').value;
            const fields = document.getElementById('renewable-fields');
            fields.style.display = renewableValue === 'yes' ? 'block' : 'none';
        }

        // åˆ‡æ›ç¶“æ¿Ÿæ´»å‹•è¡¨
        function toggleActivitiesTable() {
            const value = document.getElementById('has-applicable-activities').value;
            const selectionDiv = document.getElementById('activities-selection');
            selectionDiv.style.display = value === 'yes' ? 'block' : 'none';

            if (value !== 'yes') {
                document.getElementById('include-operating').checked = false;
                document.getElementById('include-projects').checked = false;
                updateActivityTables();
            }
        }

        // æ›´æ–°æ´»å‹•è¡¨é¡¯ç¤º
        function updateActivityTables() {
            const showOperating = document.getElementById('include-operating').checked;
            const showProjects = document.getElementById('include-projects').checked;

            document.getElementById('operating-activities-section').style.display = showOperating ? 'block' : 'none';
            document.getElementById('project-activities-section').style.display = showProjects ? 'block' : 'none';

            if (!showOperating) operatingActivityCount = 0;
            if (!showProjects) projectActivityCount = 0;
        }

        // æ–°å¢ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•
        function addOperatingActivity() {
            operatingActivityCount++;
            const container = document.getElementById('operating-activities-container');
            const activityHTML = createActivityCard('operating', operatingActivityCount);
            container.insertAdjacentHTML('beforeend', activityHTML);
        }

        // æ–°å¢å€‹åˆ¥å°ˆæ¡ˆé …ç›®
        function addProjectActivity() {
            projectActivityCount++;
            const container = document.getElementById('project-activities-container');
            const activityHTML = createActivityCard('project', projectActivityCount);
            container.insertAdjacentHTML('beforeend', activityHTML);
        }

        // å‰µå»ºæ´»å‹•å¡ç‰‡HTML
        function createActivityCard(type, sequenceNum) {
            const seq = String(sequenceNum).padStart(2, '0');
            const typeLabel = type === 'operating' ? 'ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•' : 'å€‹åˆ¥å°ˆæ¡ˆé …ç›®';
            const typeId = type === 'operating' ? 'operating' : 'project';

            return `
                <div class="activity-card" id="${typeId}-activity-${seq}" data-activity-type="${type}">
                    <button type="button" class="btn-remove-activity" onclick="removeActivity('${typeId}', '${seq}')">
                        âœ• ç§»é™¤
                    </button>
                    
                    <div class="activity-card-header">
                        <span class="activity-sequence">åºè™Ÿ ${seq}ï¼š${typeLabel}</span>
                        <span class="activity-rating" id="rating-${typeId}-${seq}" style="display:none;"></span>
                    </div>

                    <div class="esg-form-group">
                        <label>1. é©ç”¨æŒ‡å¼•ç¶“æ¿Ÿæ´»å‹•ä»£è™Ÿ <span class="required">*</span></label>
                        <select id="activity-code-${typeId}-${seq}" name="activity-code" onchange="updateActivityCategory('${typeId}', '${seq}')" required>
                            <option value="">-- è«‹é¸æ“‡ç¶“æ¿Ÿæ´»å‹•ä»£è™Ÿ --</option>
                            ${getActivityCodeOptions()}
                        </select>
                        <p class="form-hint">âœ“ å…±${Object.keys(ESG_ACTIVITIES).length}é …ç¶“æ¿Ÿæ´»å‹•ä»£ç¢¼</p>
                    </div>

                    <div class="esg-form-group">
                        <label>2. è©²é …ç›®é©ç”¨æœ¬æŒ‡å¼•ä¹‹é¡åˆ¥</label>
                        <div style="padding: 1rem; background: white; border-radius: 6px;">
                            <div style="margin-bottom: 0.75rem;">
                                <strong id="category-${typeId}-${seq}" name="category">æœªé¸æ“‡ä»£è™Ÿ</strong>
                                <span id="category-type-${typeId}-${seq}" style="color: #666; font-size: 0.9rem;"></span>
                            </div>
                            <div style="color: #999; font-size: 0.85rem;">
                                (æ­¤æ¬„ä½å°‡æ ¹æ“šä¸Šä¸€é¡Œé¸æ“‡è‡ªå‹•å¸¶å…¥)
                            </div>
                        </div>
                    </div>

                    ${type === 'operating' ? `
                    <div class="esg-form-group">
                        <label>3. è©²ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•å‰ä¸€å¹´å å…¨éƒ¨ç‡Ÿæ”¶ä¹‹æ¯”é‡ <span class="required">*</span></label>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="number" 
                                   id="revenue-share-${typeId}-${seq}" 
                                   name="revenue-share-${typeId}-${seq}"
                                   min="0" 
                                   max="100" 
                                   step="0.01"
                                   placeholder="ä¾‹å¦‚ï¼š70"
                                   style="width: 120px; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;"
                                   required>
                            <span style="font-size: 1rem; color: #666;">%</span>
                        </div>
                        <p class="form-hint">è«‹è¼¸å…¥è©²æ´»å‹•å å‰ä¸€å¹´ç¸½ç‡Ÿæ”¶çš„ç™¾åˆ†æ¯”ï¼ˆ0-100%ï¼‰</p>
                    </div>
                    ` : ''}

                    <div class="esg-section" style="border-left-color: #00b3b3;">
                        <div class="esg-section-title" style="color: #00b3b3;">æ¢ä»¶ä¸€ï¼šæ˜¯å¦ç¬¦åˆã€å°ä»»ä¸€ç’°å¢ƒç›®çš„å…·æœ‰å¯¦è³ªè²¢ç»ã€‘ï¼Ÿ</div>
                        <div class="esg-form-group checkbox-group">
                            <label>è«‹å‹¾é¸æ‰€æœ‰ç¬¦åˆä¹‹é …ç›®ï¼š</label>
                            <div id="condition1-options-${typeId}-${seq}" style="margin-top: 1rem;">
                                <p style="color: #999;">è«‹å…ˆé¸æ“‡ç¶“æ¿Ÿæ´»å‹•ä»£è™Ÿ</p>
                            </div>
                        </div>
                    </div>

                    <div class="esg-section" style="border-left-color: #00b3b3;">
                        <div class="esg-section-title" style="color: #00b3b3;">æ¢ä»¶äºŒï¼šæ˜¯å¦ç¬¦åˆã€æœªé€ æˆé‡å¤§ç’°å¢ƒå±å®³ã€‘ï¼Ÿ</div>
                        <div class="esg-form-group checkbox-group">
                            <p style="color: #666; margin-bottom: 1rem; line-height: 1.6;">
                                è¡¡é‡æœŸé–“å…§ï¼Œä¼æ¥­æ˜¯å¦æœªæ›¾å› é•åä»¥ä¸‹ç’°ä¿ç›¸é—œæ³•è¦è€Œå—åˆ°ç›®çš„äº‹æ¥­ä¸»ç®¡æ©Ÿé—œçš„é‡å¤§è£è™•ï¼Ÿ
                            </p>
                            <div class="radio-group" style="margin-top: 1rem;">
                                <div class="radio-item">
                                    <input type="radio" name="condition2-${typeId}-${seq}" value="yes" id="c2-yes-${typeId}-${seq}" onchange="updateActivityRating('${typeId}', '${seq}')">
                                    <label for="c2-yes-${typeId}-${seq}"><strong>æ˜¯</strong> - çš†æœªé•åä»»ä½•æ³•è¦ï¼ˆå®Œå…¨ç¬¦åˆæ¢ä»¶ï¼‰</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="condition2-${typeId}-${seq}" value="no" id="c2-no-${typeId}-${seq}" onchange="updateActivityRating('${typeId}', '${seq}')">
                                    <label for="c2-no-${typeId}-${seq}"><strong>å¦</strong> - æœ‰é•åè¨˜éŒ„ï¼ˆè«‹å‹¾é¸é•åçš„æ³•è¦é …ç›®ï¼‰</label>
                                </div>
                            </div>
                            <div id="condition2-violations-${typeId}-${seq}" style="display:none; margin-top: 1.5rem; padding: 1.5rem; background: #fff8f0; border-left: 4px solid #ff9800; border-radius: 6px;">
                                <p style="margin-top: 0; margin-bottom: 1rem; color: #666; font-weight: 600;">âš ï¸ è«‹å‹¾é¸è¡¡é‡æœŸé–“å…§æ›¾å› é•åçš„æ³•è¦é …ç›®ï¼š</p>
                                <div class="checkbox-group-list">
                                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0;">
                                        <div style="font-weight: 600; color: #006633; margin-bottom: 0.5rem;">1ï¸âƒ£ æ°£å€™è®Šé·æ¸›ç·©</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-climate-${typeId}-${seq}">
                                            <label for="v-climate-${typeId}-${seq}">é•åã€Šæ°£å€™è®Šé·å› æ‡‰æ³•ã€‹</label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0;">
                                        <div style="font-weight: 600; color: #006633; margin-bottom: 0.5rem;">2ï¸âƒ£ æ°´åŠæµ·æ´‹è³‡æºçš„æ°¸çºŒæ€§åŠä¿è‚²</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-water-${typeId}-${seq}">
                                            <label for="v-water-${typeId}-${seq}">é•åã€Šæ°´åˆ©æ³•ã€‹</label>
                                        </div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-ocean-${typeId}-${seq}">
                                            <label for="v-ocean-${typeId}-${seq}">é•åã€Šæµ·æ´‹æ±¡æŸ“é˜²æ²»æ³•ã€‹</label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0;">
                                        <div style="font-weight: 600; color: #006633; margin-bottom: 0.5rem;">3ï¸âƒ£ è½‰å‹è‡³å¾ªç’°ç¶“æ¿Ÿ</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-circular-${typeId}-${seq}">
                                            <label for="v-circular-${typeId}-${seq}">é•åã€Šè³‡æºå›æ”¶å†åˆ©ç”¨æ³•ã€‹</label>
                                        </div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-waste-${typeId}-${seq}">
                                            <label for="v-waste-${typeId}-${seq}">é•åã€Šå»¢æ£„ç‰©æ¸…ç†æ³•ã€‹</label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0;">
                                        <div style="font-weight: 600; color: #006633; margin-bottom: 0.5rem;">4ï¸âƒ£ æ±¡æŸ“é é˜²èˆ‡æ§åˆ¶</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-air-${typeId}-${seq}">
                                            <label for="v-air-${typeId}-${seq}">é•åã€Šç©ºæ°£æ±¡æŸ“é˜²åˆ¶æ³•ã€‹</label>
                                        </div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-water-pollution-${typeId}-${seq}">
                                            <label for="v-water-pollution-${typeId}-${seq}">é•åã€Šæ°´æ±¡æŸ“é˜²æ²»æ³•ã€‹</label>
                                        </div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-soil-${typeId}-${seq}">
                                            <label for="v-soil-${typeId}-${seq}">é•åã€ŠåœŸå£¤åŠåœ°ä¸‹æ°´æ±¡æŸ“æ•´æ²»æ³•ã€‹</label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 0;">
                                        <div style="font-weight: 600; color: #006633; margin-bottom: 0.5rem;">5ï¸âƒ£ ç”Ÿç‰©å¤šæ¨£æ€§ä¿è‚²åŠå¾©è‚²</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-biodiversity-${typeId}-${seq}">
                                            <label for="v-biodiversity-${typeId}-${seq}">é•åã€Šé‡ç”Ÿå‹•ç‰©ä¿è‚²æ³•ã€‹</label>
                                        </div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-forest-${typeId}-${seq}">
                                            <label for="v-forest-${typeId}-${seq}">é•åã€Šæ£®æ—æ³•ã€‹</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="esg-section" style="border-left-color: #00b3b3;">
                        <div class="esg-section-title" style="color: #00b3b3;">æ¢ä»¶ä¸‰ï¼šæ˜¯å¦ç¬¦åˆã€æœªé€ æˆé‡å¤§ç¤¾æœƒå±å®³ã€‘ï¼Ÿ</div>
                        <div class="esg-form-group checkbox-group">
                            <p style="color: #666; margin-bottom: 1rem; line-height: 1.6;">
                                è¡¡é‡æœŸé–“å…§ï¼Œä¼æ¥­æ˜¯å¦æœªæ›¾å› é•åä»¥ä¸‹ç¤¾æœƒç›¸é—œæ³•è¦è€Œå—åˆ°ç›®çš„äº‹æ¥­ä¸»ç®¡æ©Ÿé—œçš„é‡å¤§è£è™•ï¼Ÿ
                            </p>
                            <div class="radio-group" style="margin-top: 1rem;">
                                <div class="radio-item">
                                    <input type="radio" name="condition3-${typeId}-${seq}" value="yes" id="c3-yes-${typeId}-${seq}" onchange="updateActivityRating('${typeId}', '${seq}')">
                                    <label for="c3-yes-${typeId}-${seq}"><strong>æ˜¯</strong> - æœªæœ‰ä»»ä½•é•åè¨˜éŒ„ï¼ˆå®Œå…¨ç¬¦åˆæ¢ä»¶ï¼‰</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="condition3-${typeId}-${seq}" value="no" id="c3-no-${typeId}-${seq}" onchange="updateActivityRating('${typeId}', '${seq}')">
                                    <label for="c3-no-${typeId}-${seq}"><strong>å¦</strong> - æœ‰é•åè¨˜éŒ„ï¼ˆè«‹å‹¾é¸é•åçš„æ³•è¦é …ç›®ï¼‰</label>
                                </div>
                            </div>
                            <div id="condition3-violations-${typeId}-${seq}" style="display:none; margin-top: 1.5rem; padding: 1.5rem; background: #fef3f0; border-left: 4px solid #d32f2f; border-radius: 6px;">
                                <p style="margin-top: 0; margin-bottom: 1rem; color: #666; font-weight: 600;">âš ï¸ è«‹å‹¾é¸è¡¡é‡æœŸé–“å…§æ›¾å› é•åçš„æ³•è¦é …ç›®ï¼š</p>
                                <div class="checkbox-group-list">
                                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0;">
                                        <div style="font-weight: 600; color: #c41c3b; margin-bottom: 0.5rem;">1ï¸âƒ£ å‹å‹•åŸºæº–</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-labor-${typeId}-${seq}">
                                            <label for="v-labor-${typeId}-${seq}">é•åã€Šå‹å‹•åŸºæº–æ³•ã€‹ï¼ˆå«å·¥æ™‚ã€è–ªè³‡ã€ä¼‘å‡ç­‰ï¼‰</label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0;">
                                        <div style="font-weight: 600; color: #c41c3b; margin-bottom: 0.5rem;">2ï¸âƒ£ è·æ¥­å®‰å…¨è¡›ç”Ÿ</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-occupational-${typeId}-${seq}">
                                            <label for="v-occupational-${typeId}-${seq}">é•åã€Šè·æ¥­å®‰å…¨è¡›ç”Ÿæ³•ã€‹ï¼ˆå«è·ç½ã€å·¥å®‰ç­‰ï¼‰</label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e0e0e0;">
                                        <div style="font-weight: 600; color: #c41c3b; margin-bottom: 0.5rem;">3ï¸âƒ£ æ€§åˆ¥å¹³ç­‰åŠäººæ¬Š</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-gender-${typeId}-${seq}">
                                            <label for="v-gender-${typeId}-${seq}">é•åã€Šæ€§åˆ¥å¹³ç­‰å·¥ä½œæ³•ã€‹ï¼ˆå«æ€§é¨·æ“¾ã€æ€§åˆ¥æ­§è¦–ç­‰ï¼‰</label>
                                        </div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-child-labor-${typeId}-${seq}">
                                            <label for="v-child-labor-${typeId}-${seq}">é•åã€Šå‹å‹•åŸºæº–æ³•ã€‹ç¬¬äº”ç« ï¼ˆç«¥å·¥ã€å°‘å¹´å‹å·¥ä¿è­·ï¼‰</label>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 0;">
                                        <div style="font-weight: 600; color: #c41c3b; margin-bottom: 0.5rem;">4ï¸âƒ£ å…¶ä»–ç¤¾æœƒä¿éšœ</div>
                                        <div class="check-item">
                                            <input type="checkbox" id="v-social-${typeId}-${seq}">
                                            <label for="v-social-${typeId}-${seq}">é•åå…¶ä»–ç›¸é—œå‹å·¥ä¿è­·æˆ–äººæ¬Šæ³•è¦</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="esg-section" style="border-left-color: #d4a574;">
                        <div class="esg-section-title" style="color: #d4a574;">è½‰å‹è¨ˆç•«</div>
                        <div class="esg-form-group checkbox-group">
                            <label style="margin-bottom: 1rem;">è‹¥ä¸Šè¿°ä¸‰é …æ¢ä»¶æœªèƒ½å…¨éƒ¨ç¬¦åˆï¼Œè²´å…¬å¸æ˜¯å¦æœ‰è½‰å‹è¨ˆç•«ï¼Ÿ</label>
                            <div class="radio-group" style="margin-top: 1rem;">
                                <div class="radio-item">
                                    <input type="radio" name="transition-plan-${typeId}-${seq}" value="yes" id="trans-yes-${typeId}-${seq}" onchange="updateActivityRating('${typeId}', '${seq}')">
                                    <label for="trans-yes-${typeId}-${seq}">æ˜¯ - å·²è¨‚æœ‰å…·é«”è½‰å‹è¨ˆç•«</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="transition-plan-${typeId}-${seq}" value="no" id="trans-no-${typeId}-${seq}" onchange="updateActivityRating('${typeId}', '${seq}')">
                                    <label for="trans-no-${typeId}-${seq}">å¦ - å°šç„¡è½‰å‹è¨ˆç•«</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="transition-plan-${typeId}-${seq}" value="not-applicable" id="trans-na-${typeId}-${seq}" onchange="updateActivityRating('${typeId}', '${seq}')">
                                    <label for="trans-na-${typeId}-${seq}">ä¸é©ç”¨ - å·²å…¨éƒ¨ç¬¦åˆæ¢ä»¶</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç§»é™¤æ´»å‹•
        function removeActivity(type, seq) {
            const elementId = type === 'operating' ? `operating-activity-${seq}` : `project-activity-${seq}`;
            const element = document.getElementById(elementId);
            if (element) {
                element.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => element.remove(), 300);
            }
        }

        // æ›´æ–°ç¶“æ¿Ÿæ´»å‹•é¡åˆ¥
        function updateActivityCategory(type, seq) {
            const codeSelect = document.getElementById(`activity-code-${type}-${seq}`);
            const code = codeSelect.value;
            const categoryElement = document.getElementById(`category-${type}-${seq}`);
            const categoryTypeElement = document.getElementById(`category-type-${type}-${seq}`);
            
            if (ESG_ACTIVITIES[code]) {
                const activity = ESG_ACTIVITIES[code];
                categoryElement.textContent = activity.name;
                categoryTypeElement.textContent = `(${activity.category})`;
                updateCondition1Options(type, seq, code);
            } else {
                categoryElement.textContent = 'æœªé¸æ“‡ä»£è™Ÿ';
                categoryTypeElement.textContent = '';
            }
        }

        // ç²å–æ¢ä»¶ä¸€é¸é …ï¼ˆæ ¹æ“šç¶“æ¿Ÿæ´»å‹•ä»£è™Ÿï¼‰
        function getConditionOneOptions(code) {
            if (CONDITION_ONE_OPTIONS && CONDITION_ONE_OPTIONS[code]) {
                const conditionData = CONDITION_ONE_OPTIONS[code];
                const options = [];
                
                if (conditionData.options && Array.isArray(conditionData.options)) {
                    conditionData.options.forEach(categoryGroup => {
                        if (categoryGroup.items && Array.isArray(categoryGroup.items)) {
                            const items = categoryGroup.items;
                            
                            // æ·»åŠ åˆ†é¡æ¨™é¡Œ
                            options.push({
                                label: `ã€${categoryGroup.category}ã€‘`,
                                isCategory: true
                            });
                            
                            // åˆ†ææ•´é«”çµæ§‹ä¾†åˆ¤å®šå„é …æ˜¯å¦ç‚ºèªªæ˜æ–‡å­—
                            for (let i = 0; i < items.length; i++) {
                                const item = items[i];
                                const nextItem = items[i + 1];
                                
                                // åˆ¤æ–·ç•¶å‰é …æ˜¯å¦ç‚ºåˆ†çµ„èªªæ˜
                                // ç‰¹å¾µï¼š
                                // 1. ã€åˆ†é¡ã€‘æ ¼å¼ -> åˆ†é¡æ¨™é¡Œ
                                // 2. çµå°¾å†’è™Ÿ + ä¸‹ä¸€è¡Œæœ‰æ›´å¤šç¸®é€² -> åˆ†çµ„æ¨™é¡Œ
                                // 3. çµå°¾å†’è™Ÿ + ä¸ä»¥æ•¸å­—æˆ–å¤§å¯«å­—æ¯é–‹é ­ + æ˜¯æŒ‡ç¤ºæ€§è©å½™ + ä¸‹ä¸€è¡Œä¸å­˜åœ¨ -> ç¨ç«‹èªªæ˜
                                
                                let isGroupHeader = false;
                                
                                if (item.match(/^ã€.*ã€‘$/)) {
                                    // ã€åˆ†é¡ã€‘æ ¼å¼
                                    isGroupHeader = true;
                                } else if (item.match(/ï¼š$/)) {
                                    // çµå°¾å†’è™Ÿçš„é …ç›®
                                    const currentIndent = item.match(/^(\s*)/)[1].length;
                                    const nextIndent = nextItem ? nextItem.match(/^(\s*)/)[1].length : 0;
                                    
                                    if (nextItem && nextIndent > currentIndent) {
                                        // ä¸‹ä¸€è¡Œæœ‰æ›´å¤šç¸®é€²ï¼Œé€™æ˜¯åˆ†çµ„æ¨™é¡Œ
                                        isGroupHeader = true;
                                    } else if (item.match(/^(ä»¥ç¬¦åˆ|è‹¥ç„¡æ³•|ç¬¦åˆä»¥ä¸‹|åŒæ™‚ç¬¦åˆ|è‡³å°‘ç¬¦åˆ|é™¤ç¬¦åˆ|é‹è¼¸æ©Ÿå…·|è¨­å‚™ç¬¦åˆ|ç”¢è£½ç¬¦åˆ|ç¬¦åˆ|å…±é€šé©ç”¨|å°ã€Œ|ä»¥ä¸‹|åˆ—è¿°|åŒ…æ‹¬|æŒ‡ä¸‹åˆ—)/)) {
                                        // ç´”æŒ‡ç¤ºå¥ï¼ˆæ²’æœ‰å…·é«”å…§å®¹ï¼‰
                                        isGroupHeader = true;
                                    }
                                } else if (item.match(/^[^(]*[ï¼ˆ(]/)) {
                                    // é¡ä¼¼ã€Œ1. æ¢ä»¶æè¿°ï¼ˆèªªæ˜æ–‡å­—ï¼‰ã€çš„æ ¼å¼ï¼Œå¦‚æœä¸»è¦æ˜¯èªªæ˜æ–‡å­—
                                    // æª¢æŸ¥æ˜¯å¦ç‚ºç´”ç²¹çš„èªªæ˜ï¼ˆä¸å«å…·é«”æ¨™æº–ï¼‰
                                    if (item.match(/[ï¼š:]\s*$/) || item.match(/^[^0-9]*(\(|ï¼ˆ)/)) {
                                        isGroupHeader = true;
                                    }
                                }
                                
                                if (isGroupHeader) {
                                    // åˆ†çµ„èªªæ˜ - ä¸å¯å‹¾é¸
                                    options.push({
                                        label: item,
                                        isExplanation: true
                                    });
                                } else {
                                    // æ‰€æœ‰å…¶ä»–éƒ½æ˜¯å¯é¸é …ç›®
                                    options.push({
                                        label: `  âœ“ ${item}`
                                    });
                                }
                            }
                        }
                    });
                }
                
                return {
                    title: conditionData.title || code,
                    options: options.length > 0 ? options : [{label: 'æš«ç„¡å¯ç”¨é¸é …'}]
                };
            }
            
            return {
                title: `${code} - å¯¦è³ªè²¢ç»æª¢æŸ¥`,
                options: [{label: 'æš«ç„¡è©²ç¶“æ¿Ÿæ´»å‹•çš„æ¢ä»¶ä¸€æ¨™æº–'}]
            };
        }

        // æ›´æ–°æ¢ä»¶ä¸€é¸é …
        function updateCondition1Options(type, seq, code) {
            const container = document.getElementById(`condition1-options-${type}-${seq}`);
            const conditionData = getConditionOneOptions(code);
            
            let html = `<label style="display: block; margin-bottom: 1rem; font-weight: 600; color: #333;">
                        ${conditionData.title} - å¯¦è³ªè²¢ç»æª¢æŸ¥é …ç›®ï¼š
                        </label>`;
            
            conditionData.options.forEach((option, index) => {
                const id = `c1-${code}-${index}-${type}-${seq}`;
                
                // å¦‚æœæ˜¯åˆ†é¡æ¨™é¡Œï¼Œç”¨ä¸åŒæ¨£å¼
                if (option.isCategory) {
                    html += `
                        <div style="margin-top: 1rem; margin-bottom: 0.5rem; padding: 0.5rem; background: #f0f7f3; border-left: 3px solid #006633; border-radius: 4px;">
                            <strong style="color: #006633;">${option.label}</strong>
                        </div>
                    `;
                } 
                // å¦‚æœæ˜¯èªªæ˜æ–‡å­—ï¼Œé¡¯ç¤ºç‚ºç°è‰²æ–‡æœ¬ï¼ˆä¸å¯å‹¾é¸ï¼‰
                else if (option.isExplanation) {
                    html += `
                        <div style="margin: 0.75rem 0; padding: 0.75rem 1rem; background: #fafafa; color: #666; font-size: 0.9rem; border-left: 3px solid #ccc; border-radius: 4px; line-height: 1.5;">
                            ğŸ“ ${option.label}
                        </div>
                    `;
                }
                // å¦å‰‡æ˜¯å¯¦éš›æ¨™æº–é …ç›®ï¼Œé¡¯ç¤ºç‚ºå¯å‹¾é¸çš„è¤‡é¸æ¡†
                else {
                    html += `
                        <div class="checkbox-item" style="margin-left: 1rem;">
                            <input type="checkbox" id="${id}" name="condition1-${type}-${seq}" data-type="${type}" data-seq="${seq}" onchange="updateActivityRating('${type}', '${seq}')">
                            <label for="${id}">${option.label}</label>
                        </div>
                    `;
                }
            });

            container.innerHTML = html;
        }

        // è¨ˆç®—æ´»å‹•è©•ç­‰
        function updateActivityRating(type, seq) {
            const c2Radio = document.querySelector(`input[name="condition2-${type}-${seq}"]:checked`);
            const c2Value = c2Radio ? c2Radio.value : null;

            // åˆ‡æ›æ¢ä»¶äºŒé•åé …ç›®é¡¯ç¤º
            if (c2Radio) {
                const violationsDiv = document.getElementById(`condition2-violations-${type}-${seq}`);
                violationsDiv.style.display = c2Value === 'no' ? 'block' : 'none';
            }

            const c3Radio = document.querySelector(`input[name="condition3-${type}-${seq}"]:checked`);
            const c3Value = c3Radio ? c3Radio.value : null;

            // åˆ‡æ›æ¢ä»¶ä¸‰é•åé …ç›®é¡¯ç¤º
            if (c3Radio) {
                const violationsDiv = document.getElementById(`condition3-violations-${type}-${seq}`);
                violationsDiv.style.display = c3Value === 'no' ? 'block' : 'none';
            }

            const condition1Checked = document.querySelector(`#condition1-options-${type}-${seq} input[type="checkbox"]:checked`);
            const condition1 = !!condition1Checked;
            const condition2 = c2Value === 'yes';
            const condition3 = c3Value === 'yes';
            const transitionRadio = document.querySelector(`input[name="transition-plan-${type}-${seq}"]:checked`);
            const transitionValue = transitionRadio ? transitionRadio.value : null;

            let rating = '';
            let ratingClass = '';

            // è©•ç­‰é‚è¼¯
            if (condition1 && condition2 && condition3) {
                rating = 'Y (ç¬¦åˆ)';
                ratingClass = 'rating-y';
            } else if ((!condition1 || !condition2 || !condition3) && transitionValue === 'yes') {
                rating = 'T (è½‰å‹ä¸­)';
                ratingClass = 'rating-t';
            } else if ((!condition1 || !condition2 || !condition3) && transitionValue === 'no') {
                rating = 'N (ä¸ç¬¦åˆ)';
                ratingClass = 'rating-n';
            } else if (transitionValue === 'not-applicable') {
                rating = 'X (ä¸é©ç”¨)';
                ratingClass = 'rating-x';
            }

            // æ›´æ–°è©•èªé¡¯ç¤º
            if (rating) {
                const ratingElement = document.getElementById(`rating-${type}-${seq}`);
                ratingElement.className = `activity-rating ${ratingClass}`;
                ratingElement.textContent = rating;
                ratingElement.style.display = 'inline-block';
            }
        }

        // æäº¤è©•ä¼°
        function submitAssessment() {
            console.log('ğŸ” é–‹å§‹æ”¶é›†è¡¨å–®æ•¸æ“š...');
            
            // é¡¯ç¤ºè¼‰å…¥ä»‹é¢
            const loadingDialog = document.getElementById('assessment-loading');
            loadingDialog.style.display = 'flex';
            
            // ç²å–æäº¤æŒ‰éˆ•ï¼ˆç”¨æ–¼æ›´æ–°ç‹€æ…‹ï¼‰
            const submitBtn = document.querySelector('.btn-submit');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'è©•ä¼°ä¸­...';
            }
            
            // å»¶é²åŸ·è¡Œï¼Œè®“è¼‰å…¥ä»‹é¢å…ˆé¡¯ç¤º
            setTimeout(() => {
                try {
                    // æ”¶é›†æ‰€æœ‰æ•¸æ“š
                    const formData = {
                        table1Data: {
                            companyName: document.getElementById('company-name').value,
                            companyTaxId: document.getElementById('company-tax-id').value,
                            pastYear: document.getElementById('past-year').value,
                            assessmentDate: document.getElementById('assessment-date').value,
                            revenue: document.getElementById('revenue').value,
                            totalAssets: document.getElementById('total-assets').value,
                            dataAttribute: document.getElementById('data-attribute').value,
                            thirdPartyVerification: document.getElementById('scope1-verification').checked || 
                                                   document.getElementById('scope2-verification').checked ||
                                                   document.getElementById('scope3-verification').checked,
                            sustainabilityReport: document.querySelector('input[name="g7"]:checked')?.value === 'yes'
                        },
                        esgAssessment: {
                            e1: document.querySelector('input[name="e1"]:checked')?.value,
                            e2: document.querySelector('input[name="e2"]:checked')?.value,
                            e3: document.querySelector('input[name="e3"]:checked')?.value,
                            e4: document.querySelector('input[name="e4"]:checked')?.value,
                            e5: document.querySelector('input[name="e5"]:checked')?.value,
                            e6: document.querySelector('input[name="e6"]:checked')?.value,
                            s1: document.querySelector('input[name="s1"]:checked')?.value,
                            s2: document.querySelector('input[name="s2"]:checked')?.value,
                            s3: document.querySelector('input[name="s3"]:checked')?.value,
                            s4: document.querySelector('input[name="s4"]:checked')?.value,
                            s5: document.querySelector('input[name="s5"]:checked')?.value,
                            g1: document.querySelector('input[name="g1"]:checked')?.value,
                            g2: document.querySelector('input[name="g2"]:checked')?.value,
                            g3: document.querySelector('input[name="g3"]:checked')?.value,
                            g4: document.querySelector('input[name="g4"]:checked')?.value,
                            g5: document.querySelector('input[name="g5"]:checked')?.value,
                            g6: document.querySelector('input[name="g6"]:checked')?.value,
                            g7: document.querySelector('input[name="g7"]:checked')?.value
                        },
                        activities: []
                    };

                    console.log('ğŸ“‹ è¡¨æ ¼ä¸€æ•¸æ“šå·²æ”¶é›†');

                    // æ”¶é›†æ‰€æœ‰æ´»å‹•å¡ç‰‡ï¼ˆç„¡è«–æ˜¯ç‡Ÿé‹é‚„æ˜¯å°ˆæ¡ˆï¼‰
                    const allActivityCards = document.querySelectorAll('[data-activity-type]');
                    console.log(`ğŸ¯ æ‰¾åˆ° ${allActivityCards.length} å€‹æ´»å‹•å¡ç‰‡`);

                    allActivityCards.forEach((card, index) => {
                        const activityType = card.getAttribute('data-activity-type');
                        const cardId = card.id; // e.g., "operating-activity-01" or "project-activity-01"
                        
                        // å¾ cardId æå–åºè™Ÿ
                        const seqMatch = cardId.match(/activity-(\d+)/);
                        const seq = seqMatch ? seqMatch[1] : String(index + 1).padStart(2, '0');
                        const typeLabel = activityType === 'operating' ? 'operating' : 'project';
                        
                        console.log(`ğŸ“Œ è™•ç† ${typeLabel} æ´»å‹• ${seq}`);
                        
                        // æ”¶é›†ç¶“æ¿Ÿæ´»å‹•ä»£è™Ÿ
                        const codeSelect = card.querySelector(`select[name="activity-code"]`);
                        const activityCode = codeSelect?.value;
                        
                        if (!activityCode) {
                            console.log(`âš ï¸ æ´»å‹• ${seq} æœªé¸æ“‡ä»£è™Ÿï¼Œè·³é`);
                            return;
                        }
                        
                        // å¾ select ä¸­ç²å–æ´»å‹•åç¨±
                        const activityName = codeSelect?.options[codeSelect.selectedIndex]?.text || '';
                        
                        // ç²å–é¡åˆ¥ï¼ˆå¾ ESG_ACTIVITIES æ•¸æ“šä¸­ï¼‰
                        const activity = ESG_ACTIVITIES[activityCode];
                        const category = activity?.category || 'ä¸€èˆ¬ç¶“æ¿Ÿæ´»å‹•';
                        
                        // æ”¶é›†ç‡Ÿæ”¶æ¯”é‡ï¼ˆåƒ…ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•ï¼‰
                        let revenueShare = null;
                        if (activityType === 'operating') {
                            const revenueShareInput = card.querySelector(`input[name="revenue-share-${typeLabel}-${seq}"]`);
                            revenueShare = revenueShareInput?.value ? parseFloat(revenueShareInput.value) : null;
                        }
                        
                        // æ”¶é›†æ¢ä»¶ä¸€ï¼šæª¢æŸ¥æ‰€æœ‰ condition1 å¾©é¸æ¡†æ˜¯å¦è¢«å‹¾é¸ï¼Œä¸¦æ”¶é›†å…·é«”é …ç›®
                        const condition1Inputs = card.querySelectorAll(`input[name^="condition1-"]:checked`);
                        const condition1Checked = condition1Inputs.length > 0;
                        const condition1Items = [];
                        condition1Inputs.forEach(input => {
                            // å¾ label æ–‡æœ¬ä¸­æå–ç’°å¢ƒç›®çš„é¡å‹
                            const label = card.querySelector(`label[for="${input.id}"]`);
                            if (label) {
                                const labelText = label.textContent || '';
                                // æª¢æŸ¥ label æ–‡æœ¬æ˜¯å¦åŒ…å«ç’°å¢ƒç›®çš„é¡å‹é—œéµè©
                                if (labelText.includes('æ°£å€™è®Šé·æ¸›ç·©') || labelText.includes('æ¸›ç·©')) {
                                    if (!condition1Items.includes('æ°£å€™è®Šé·æ¸›ç·©')) {
                                        condition1Items.push('æ°£å€™è®Šé·æ¸›ç·©');
                                    }
                                }
                                if (labelText.includes('æ°£å€™è®Šé·èª¿é©') || labelText.includes('èª¿é©')) {
                                    if (!condition1Items.includes('æ°£å€™è®Šé·èª¿é©')) {
                                        condition1Items.push('æ°£å€™è®Šé·èª¿é©');
                                    }
                                }
                                if (labelText.includes('æ°´åŠæµ·æ´‹è³‡æº') || labelText.includes('æ°´åŠæµ·æ´‹')) {
                                    if (!condition1Items.includes('æ°´åŠæµ·æ´‹è³‡æºçš„æ°¸çºŒæ€§åŠä¿è‚²')) {
                                        condition1Items.push('æ°´åŠæµ·æ´‹è³‡æºçš„æ°¸çºŒæ€§åŠä¿è‚²');
                                    }
                                }
                                if (labelText.includes('æ±¡æŸ“é é˜²') || labelText.includes('æ±¡æŸ“')) {
                                    if (!condition1Items.includes('æ±¡æŸ“é é˜²èˆ‡æ§åˆ¶')) {
                                        condition1Items.push('æ±¡æŸ“é é˜²èˆ‡æ§åˆ¶');
                                    }
                                }
                                if (labelText.includes('ç”Ÿç‰©å¤šæ¨£æ€§') || labelText.includes('ç”Ÿç‰©')) {
                                    if (!condition1Items.includes('ç”Ÿç‰©å¤šæ¨£æ€§ä¿è‚²åŠå¾©è‚²')) {
                                        condition1Items.push('ç”Ÿç‰©å¤šæ¨£æ€§ä¿è‚²åŠå¾©è‚²');
                                    }
                                }
                                if (labelText.includes('å¾ªç’°ç¶“æ¿Ÿ') || labelText.includes('å¾ªç’°')) {
                                    if (!condition1Items.includes('è½‰å‹è‡³å¾ªç’°ç¶“æ¿Ÿ')) {
                                        condition1Items.push('è½‰å‹è‡³å¾ªç’°ç¶“æ¿Ÿ');
                                    }
                                }
                            }
                        });
                        
                        // æ”¶é›†æ¢ä»¶äºŒ - æ§‹å»ºæ­£ç¢ºçš„ name å±¬æ€§
                        const condition2Name = `condition2-${typeLabel}-${seq}`;
                        const condition2Input = card.querySelector(`input[name="${condition2Name}"]:checked`);
                        const condition2 = condition2Input?.value === 'yes';
                        
                        // æ”¶é›†æ¢ä»¶äºŒçš„å…·é«”é•åé …ç›®ï¼ˆå¦‚æœæ¢ä»¶äºŒç‚ºå¦ï¼‰
                        const condition2Violations = [];
                        if (!condition2) {
                            const violationInputs = card.querySelectorAll(`#condition2-violations-${typeLabel}-${seq} input[type="checkbox"]:checked`);
                            violationInputs.forEach(input => {
                                const id = input.id;
                                if (id.includes('climate')) condition2Violations.push('æ°£å€™è®Šé·æ¸›ç·©');
                                else if (id.includes('water')) condition2Violations.push('æ°´åŠæµ·æ´‹è³‡æºçš„æ°¸çºŒæ€§åŠä¿è‚²');
                                else if (id.includes('ocean')) condition2Violations.push('æ°´åŠæµ·æ´‹è³‡æºçš„æ°¸çºŒæ€§åŠä¿è‚²');
                                else if (id.includes('pollution')) condition2Violations.push('æ±¡æŸ“é é˜²èˆ‡æ§åˆ¶');
                                else if (id.includes('biodiversity')) condition2Violations.push('ç”Ÿç‰©å¤šæ¨£æ€§ä¿è‚²åŠå¾©è‚²');
                                else if (id.includes('circular')) condition2Violations.push('è½‰å‹è‡³å¾ªç’°ç¶“æ¿Ÿ');
                            });
                        }
                        
                        // æ”¶é›†æ¢ä»¶ä¸‰ - æ§‹å»ºæ­£ç¢ºçš„ name å±¬æ€§
                        const condition3Name = `condition3-${typeLabel}-${seq}`;
                        const condition3Input = card.querySelector(`input[name="${condition3Name}"]:checked`);
                        const condition3 = condition3Input?.value === 'yes';
                        
                        // æ”¶é›†è½‰å‹è¨ˆç•« - æ§‹å»ºæ­£ç¢ºçš„ name å±¬æ€§
                        const transitionPlanName = `transition-plan-${typeLabel}-${seq}`;
                        const transitionPlanInput = card.querySelector(`input[name="${transitionPlanName}"]:checked`);
                        let transitionPlan = transitionPlanInput?.value;
                        
                        // è½‰æ›è½‰å‹è¨ˆç•«å€¼
                        if (transitionPlan === 'yes') {
                            transitionPlan = 'æ˜¯';
                        } else if (transitionPlan === 'no') {
                            transitionPlan = 'å¦';
                        } else if (transitionPlan === 'not-applicable') {
                            transitionPlan = 'ä¸é©ç”¨';
                        }
                        
                        console.log(`ğŸ” æ¢ä»¶äºŒåç¨±: ${condition2Name}, å€¼: ${condition2Input?.value || 'æœªé¸æ“‡'}`);
                        console.log(`ğŸ” æ¢ä»¶ä¸‰åç¨±: ${condition3Name}, å€¼: ${condition3Input?.value || 'æœªé¸æ“‡'}`);
                        console.log(`ğŸ” è½‰å‹è¨ˆç•«åç¨±: ${transitionPlanName}, å€¼: ${transitionPlanInput?.value || 'æœªé¸æ“‡'} â†’ ${transitionPlan}`);
                        
                        // è¨ˆç®—è©•ç´š
                        let rating = 'N';
                        if (category === 'ä¸é©ç”¨') {
                            rating = 'X';
                        } else if (condition1Checked && condition2 && condition3) {
                            rating = 'Y';
                        } else if ((!condition1Checked || !condition2 || !condition3) && transitionPlan === 'æ˜¯') {
                            rating = 'T';
                        }
                        
                        console.log(`âœ… æ´»å‹• ${seq} (${activityCode}): C1=${condition1Checked}, C2=${condition2}, C3=${condition3}, Rating=${rating}`);
                        
                        formData.activities.push({
                            sequenceNum: seq,
                            type: activityType,
                            activityCode: activityCode,
                            activityName: activityName,
                            category: category,
                            rating: rating,
                            revenueShare: revenueShare, // ç‡Ÿæ”¶æ¯”é‡ï¼ˆåƒ…ç‡Ÿé‹ç¶“æ¿Ÿæ´»å‹•ï¼‰
                            condition1: condition1Checked,
                            condition1Items: condition1Items, // æ¢ä»¶ä¸€çš„å…·é«”ç’°å¢ƒç›®çš„é¡å‹
                            condition2: condition2,
                            condition2Violations: condition2Violations, // æ¢ä»¶äºŒçš„å…·é«”é•åé …ç›®
                            condition3: condition3,
                            transitionPlan: transitionPlan
                        });
                    });

                    console.log('âœ… æ‰€æœ‰æ´»å‹•å·²æ”¶é›†ï¼Œå…±', formData.activities.length, 'é …');
                    console.log('ğŸ“Š å®Œæ•´è¡¨å–®æ•¸æ“š:', formData);

                    // é©—è­‰å¿…å¡«é …
                    if (!formData.table1Data.companyName) {
                        alert('è«‹å¡«å¯«ä¼æ¥­åç¨±');
                        return;
                    }

                    // æäº¤åˆ° API
                    fetch('/api/submit-esg-assessment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.status === 'success') {
                            // ä¿å­˜çµæœåˆ° localStorage
                            localStorage.setItem('esgResult', JSON.stringify(result));
                            
                            // ä¿å­˜å®Œæ•´æ•¸æ“šåˆ°localStorageï¼ˆç”¨æ–¼PDFç”Ÿæˆï¼‰
                            const fullAssessmentData = {
                                companyName: document.getElementById('company-name').value,
                                companyTaxId: document.getElementById('company-tax-id').value,
                                year: document.getElementById('past-year').value,
                                date: document.getElementById('assessment-date').value,
                                revenue: document.getElementById('revenue').value,
                                totalAssets: document.getElementById('total-assets').value,
                                scope1Emissions: parseFloat(document.getElementById('scope1-emissions')?.value || 0),
                                scope2Emissions: parseFloat(document.getElementById('scope2-emissions')?.value || 0),
                                scope3Emissions: parseFloat(document.getElementById('scope3-emissions')?.value || 0),
                                electricityUsage: parseFloat(document.getElementById('electricity-usage')?.value || 0),
                                waterUsage: parseFloat(document.getElementById('water-usage')?.value || 0),
                                esgAssessment: formData.esgAssessment,
                                activities: formData.activities,
                                scores: result.scores,
                                rating: result.rating,
                                ratingDescription: result.ratingDescription,
                                loanDiscount: result.loanDiscount
                            };
                            
                            localStorage.setItem('esgFullData', JSON.stringify(fullAssessmentData));
                            
                            // å°å‘çµæœé é¢
                            showResultModal(result);
                        } else {
                            alert('âŒ è©•ä¼°å¤±æ•—ï¼š' + result.message);
                            submitBtn.disabled = false;
                            submitBtn.textContent = 'ğŸ“Š æäº¤è©•ä¼°ä¸¦æŸ¥çœ‹çµæœ';
                        }
                        
                        // âœ… éš±è—è¼‰å…¥ä»‹é¢ï¼ˆåœ¨çµæœé¡¯ç¤ºå¾Œï¼‰
                        loadingDialog.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('æäº¤éŒ¯èª¤ï¼š', error);
                        alert('âŒ æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'ğŸ“Š æäº¤è©•ä¼°ä¸¦æŸ¥çœ‹çµæœ';
                        
                        // âœ… éš±è—è¼‰å…¥ä»‹é¢ï¼ˆç™¼ç”ŸéŒ¯èª¤æ™‚ï¼‰
                        loadingDialog.style.display = 'none';
                    });
                } catch (error) {
                    console.error('è©•ä¼°éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼š', error);
                    alert('âŒ è©•ä¼°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ğŸ“Š æäº¤è©•ä¼°ä¸¦æŸ¥çœ‹çµæœ';
                    // âœ… éš±è—è¼‰å…¥ä»‹é¢ï¼ˆåŒæ­¥éŒ¯èª¤æ™‚ï¼‰
                    loadingDialog.style.display = 'none';
                }
            }, 1000); // å»¶é² 1 ç§’é˜
        }

        // é¡¯ç¤ºçµæœå½ˆçª—
        function showResultModal(result) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            const ratingColor = {
                'A': '#006633',
                'B': '#00b3b3',
                'C': '#ff9800'
            };
            
            const ratingEmoji = {
                'A': 'ğŸ†',
                'B': 'ğŸ‘',
                'C': 'ğŸ“ˆ'
            };
            
            const content = `
                <div style="background: white; border-radius: 12px; padding: 2rem; max-width: 700px; max-height: 80vh; overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
                    <h2 style="text-align: center; color: #333; margin-bottom: 1rem;">âœ… è©•ä¼°å®Œæˆ</h2>
                    
                    <div style="text-align: center; margin: 2rem 0; padding: 1.5rem; background: linear-gradient(135deg, ${ratingColor[result.rating]}22 0%, ${ratingColor[result.rating]}11 100%); border-radius: 12px; border: 2px solid ${ratingColor[result.rating]};">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">${ratingEmoji[result.rating]}</div>
                        <div style="font-size: 2.5rem; font-weight: 700; color: ${ratingColor[result.rating]}; margin-bottom: 0.5rem;">${result.rating} ç´š</div>
                        <div style="font-size: 1.1rem; color: #333; font-weight: 600;">${result.ratingDescription}</div>
                    </div>
                    
                    <div style="margin: 1.5rem 0; padding: 1rem; background: #f5f5f5; border-radius: 8px;">
                        <h3 style="color: #333; margin-top: 0;">ğŸ“Š è©•åˆ†çµ±è¨ˆ</h3>
                        <p style="margin: 0.5rem 0;"><strong>ESG è¡¨ç¾ï¼š</strong> ${result.scores.esg}%</p>
                        <p style="margin: 0.5rem 0;"><strong>ç¶“æ¿Ÿæ´»å‹•ç¬¦åˆåº¦ï¼š</strong> ${result.scores.compliant}%</p>
                        <p style="margin: 0.5rem 0;"><strong>ç¬¦åˆ (Y)ï¼š</strong> ${result.scores.details.Y} é … | <strong>è½‰å‹ä¸­ (T)ï¼š</strong> ${result.scores.details.T} é … | <strong>ä¸ç¬¦åˆ (N)ï¼š</strong> ${result.scores.details.N} é …</p>
                        ${result.scores.compliant === 0 ? `
                        <div style="margin-top: 1rem; padding: 1rem; background: #fff3e0; border-left: 4px solid #ff9800; border-radius: 6px;">
                            <p style="color: #e65100; margin: 0; font-size: 0.95rem;">
                                ğŸ’¡ <strong>æç¤ºï¼š</strong> ç¶“æ¿Ÿæ´»å‹•ç¬¦åˆåº¦ç‚º 0% è¡¨ç¤ºæ‚¨æœªå¡«å¯«è¡¨æ ¼äºŒï¼ˆç¶“æ¿Ÿæ´»å‹•è©•ä¼°ï¼‰ã€‚è‹¥è¦è©•ä¼°ç‰¹å®šç¶“æ¿Ÿæ´»å‹•ï¼Œè«‹è¿”å›è¡¨æ ¼äºŒå¡«å¯«ç›¸é—œä¿¡æ¯ã€‚
                            </p>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div style="margin: 1.5rem 0; padding: 1.5rem; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border: 2px solid #4caf50; border-radius: 8px;">
                        <h3 style="color: #2e7d32; margin-top: 0; font-size: 1.2rem;">ğŸ’° è²¸æ¬¾åˆ©ç‡å„ªæƒ </h3>
                        <div style="font-size: 2.5rem; font-weight: 700; color: #4caf50; margin: 1rem 0;">æ¸›å°‘ ${result.loanDiscount.discount}%</div>
                        <p style="color: #333; font-weight: 600; margin: 0.5rem 0; font-size: 1.1rem;">${result.loanDiscount.description}</p>
                        
                        <div style="margin: 1rem 0; padding: 1rem; background: #e8f5e9; border-radius: 6px; border: 1px solid #81c784;">
                            <p style="color: #2e7d32; margin: 0; font-weight: 600;">ğŸ“Š åˆ©ç‡å„ªæƒ ç¯„åœ</p>
                            <p style="color: #1b5e20; font-size: 1.1rem; margin: 0.5rem 0 0 0; font-weight: 700;">${result.loanDiscount.discountRange}</p>
                        </div>
                        
                        <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 6px; border-left: 4px solid #4caf50;">
                            <p style="color: #333; font-weight: 600; margin-top: 0; margin-bottom: 0.75rem;">âœ¨ å°ˆå±¬æ¬Šç›Šï¼š</p>
                            <ul style="margin: 0; padding-left: 1.5rem; color: #555;">
                                ${result.loanDiscount.benefits.map(benefit => `<li style="margin: 0.5rem 0; line-height: 1.5;">${benefit}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="margin-top: 1rem; padding: 1rem; background: #fffde7; border-radius: 6px; border-left: 4px solid #fbc02d;">
                            <p style="color: #666; font-size: 0.95rem; margin: 0;">
                                ğŸ“Œ <strong>å„ªæƒ æ¢ä»¶ï¼š</strong> ${result.loanDiscount.condition}
                            </p>
                        </div>
                    </div>
                    
                    <div style="margin: 1.5rem 0; padding: 1.5rem; background: #fff8f0; border-left: 4px solid #ff9800; border-radius: 8px;">
                        <h3 style="color: #333; margin-top: 0; font-size: 1.1rem;">ğŸ’¡ å»ºè­°èˆ‡å›é¥‹</h3>
                        <div style="color: #555; line-height: 1.9; white-space: pre-line; word-break: break-word; font-size: 0.95rem; letter-spacing: 0.3px;">
                            ${result.feedback}
                        </div>
                    </div>
                    
                    ${result.supplementaryResources && result.supplementaryResources.length > 0 ? `
                    <div style="margin: 2rem 0; padding: 1.5rem; background: linear-gradient(135deg, #e8f7ff 0%, #f0e5ff 100%); border: 2px solid #6366f1; border-radius: 12px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);">
                        <h3 style="color: #4f46e5; margin-top: 0; font-size: 1.1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="font-size: 1.4rem;">ğŸ“š</span>
                            è£œå……è³‡æº
                        </h3>
                        <p style="color: #666; font-size: 0.9rem; margin: 0.75rem 0 1.5rem 0; line-height: 1.6;">
                            ä»¥ä¸‹è³‡æºå¯å”åŠ©è²´å…¬å¸é€²ä¸€æ­¥æå‡æ°¸çºŒç™¼å±•æ°´æº–ï¼Œå»ºè­°æ ¹æ“šè²´å…¬å¸éœ€æ±‚æŸ¥é–±ç›¸é—œå…§å®¹ï¼š
                        </p>
                        
                        ${result.supplementaryResources.map((resource, idx) => `
                        <div style="margin: 1.25rem 0; padding: 1.25rem; background: white; border-radius: 8px; border-left: 4px solid #6366f1; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div style="display: flex; align-items: flex-start; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <span style="background: #eef2ff; color: #6366f1; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; flex-shrink: 0;">
                                    ${idx + 1}
                                </span>
                                <h4 style="color: #333; margin: 0; font-weight: 600; font-size: 1rem; line-height: 1.5;">
                                    ${resource.title}
                                </h4>
                            </div>
                            <p style="color: #555; font-size: 0.9rem; margin: 0.5rem 0 0.75rem 0; margin-left: 3.5rem; line-height: 1.6;">
                                ${resource.description}
                            </p>
                            <div style="margin-left: 3.5rem; display: flex; gap: 0.75rem; align-items: center;">
                                <a href="${resource.url}" target="_blank" style="display: inline-block; padding: 0.5rem 1rem; background: linear-gradient(135deg, #6366f1 0%, #7c3aed 100%); color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.85rem; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);">
                                    ğŸ”— æŸ¥é–±è³‡æº
                                </a>
                                <span style="color: #999; font-size: 0.75rem; word-break: break-all; flex: 1; line-height: 1.4;">
                                    ${resource.url}
                                </span>
                            </div>
                        </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <div style="text-align: center; margin-top: 2rem; display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="this.closest('div').parentElement.parentElement.remove()" style="padding: 0.75rem 1.5rem; background: #f0f0f0; color: #333; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">é—œé–‰</button>
                        <button onclick="window.location.href='/esg-result'" style="padding: 0.75rem 1.5rem; background: #006633; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">ğŸ“„ æŸ¥çœ‹çµæœPDF</button>
                        <button onclick="location.reload()" style="padding: 0.75rem 1.5rem; background: #00b3b3; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">ğŸ”„ é‡æ–°è©•ä¼°</button>
                    </div>
                </div>
            `;
            
            modal.innerHTML = content;
            document.body.appendChild(modal);
        }

        // åˆ‡æ›åˆ°è¡¨æ ¼äºŒ
        function goToTable2() {
            document.getElementById('table1').classList.remove('active');
            document.getElementById('table2').classList.add('active');
            // æ›´æ–° tab æŒ‰éˆ•çš„æ´»å‹•ç‹€æ…‹
            document.querySelectorAll('.esg-tab-btn').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.esg-tab-btn')[1].classList.add('active');
            document.getElementById('has-applicable-activities').focus(); // èšç„¦åˆ°è¡¨æ ¼äºŒçš„é¸æ“‡æ¬„ä½
        }

        // åˆ‡æ›åˆ°è¡¨æ ¼ä¸€
        function goToTable1() {
            document.getElementById('table2').classList.remove('active');
            document.getElementById('table1').classList.add('active');
            // æ›´æ–° tab æŒ‰éˆ•çš„æ´»å‹•ç‹€æ…‹
            document.querySelectorAll('.esg-tab-btn').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.esg-tab-btn')[0].classList.add('active');
            // å¦‚æœè¡¨æ ¼äºŒæœ‰æ´»å‹•ï¼Œå‰‡å›åˆ°è¡¨æ ¼ä¸€æ™‚ï¼Œéœ€è¦é‡æ–°è¨ˆç®—è©•ç­‰
            // é€™è£¡ç°¡åŒ–è™•ç†ï¼Œç›´æ¥ç§»é™¤æ´»å‹•å¡ç‰‡ï¼Œé¿å…é‡è¤‡è¨ˆç®—
            document.getElementById('operating-activities-container').innerHTML = '';
            document.getElementById('project-activities-container').innerHTML = '';
            operatingActivityCount = 0;
            projectActivityCount = 0;
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… ESGè©•ä¼°è¡¨å–®å·²åŠ è¼‰');
            
            // åˆå§‹åŒ–é€²åº¦è¨ˆç®—
            initProgressTracking();
        });

        // é€²åº¦è¿½è¹¤å‡½æ•¸
        function initProgressTracking() {
            const requiredFields = [
                'company-name', 'company-tax-id', 'past-year', 'assessment-date',
                'revenue', 'total-assets', 'audit-type',
                'scope1-emissions', 'scope2-emissions', 'scope3-emissions',
                'electricity-usage', 'water-usage', 'renewable-energy'
            ];
            
            document.getElementById('total-fields').textContent = requiredFields.length;
            
            // ç›£è½æ‰€æœ‰å¿…å¡«å­—æ®µçš„è®ŠåŒ–
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', updateProgress);
                    field.addEventListener('input', updateProgress);
                }
            });
            
            // åˆå§‹åŒ–ä¸€æ¬¡é€²åº¦
            updateProgress();
        }

        function updateProgress() {
            const requiredFields = [
                'company-name', 'company-tax-id', 'past-year', 'assessment-date',
                'revenue', 'total-assets', 'audit-type',
                'scope1-emissions', 'scope2-emissions', 'scope3-emissions',
                'electricity-usage', 'water-usage', 'renewable-energy'
            ];
            
            let completedCount = 0;
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.value && field.value.trim() !== '') {
                    completedCount++;
                }
            });
            
            const percentage = Math.round((completedCount / requiredFields.length) * 100);
            
            document.getElementById('progress-percentage').textContent = percentage;
            document.getElementById('completed-fields').textContent = completedCount;
            document.getElementById('progress-fill').style.width = percentage + '%';
        }
    </script>
    <script src="/js/chat-assistant.js"></script>
</body>
</html>
